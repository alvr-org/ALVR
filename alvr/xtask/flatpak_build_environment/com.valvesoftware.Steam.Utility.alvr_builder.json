{
  "id": "com.valvesoftware.Steam.Utility.alvr_builder",
  "branch": "stable",
  "sdk": "org.freedesktop.Sdk//23.08",
  "sdk-extensions": [
    "org.freedesktop.Sdk.Extension.llvm16",
    "org.freedesktop.Sdk.Extension.rust-stable"
  ],
  "runtime": "com.valvesoftware.Steam",
  "runtime-version": "stable",
  "build-extension": true,
  "appstream-compose": false,
  "separate-locales": false,
  "build-options": {
    "prefix": "/app/utils/alvr_builder",
    "append-path": "/usr/lib/sdk/llvm16/bin:/usr/lib/sdk/rust-stable/bin:/app/utils/alvr_builder/bin:/app/utils/alvr_builder/tmp/cuda/cuda_nvcc/bin",
    "prepend-ld-library-path": "/app/utils/alvr_builder/lib",
    "prepend-pkg-config-path": "/app/utils/alvr_builder/lib/pkgconfig",
    "strip": true,
    "env": { "PREFIX": "/app/utils/alvr_builder" },
    "build-args": [ "--share=network", "--filesystem=xdg-data" ]
  },
  "cleanup": [
    "/tmp",
    "/lib/*.a",
    "/lib/*.la",
    "/share/doc",
    "/share/man"
  ],
  "modules": [
    {
      "name": "alvr",
      "buildsystem": "simple",
      "build-options": {
        "env": {
          "RUST_BACKTRACE": "full",
          "CURL_HOME": "/run/build/alvr",
          "CPATH": "/app/utils/alvr_builder/include",
          "CUDA_HOME": "/app/utils/alvr_builder/tmp/cuda/",
          "NVCC_PREPEND_FLAGS": "-I /app/utils/alvr_builder/tmp/cuda/cuda_nvcc/include -I /app/utils/alvr_builder/tmp/cuda/cuda_cudart/include -L /app/utils/alvr_builder/tmp/cuda/cuda_nvcc/lib64 -L /app/utils/alvr_builder/tmp/cuda/cuda_rt/lib64"
        }
      },
      "build-commands": [
        "ls -al /app/utils/alvr_builder/tmp/cuda",
        "echo 'insecure' >> .curlrc",
        "mkdir -p /app/utils/alvr_builder/lib/pkgconfig/",
        "cp /run/build/alvr/alvr/xtask/flatpak_build_environment/cuda.pc /app/utils/alvr_builder/lib/pkgconfig/",
        "cargo xtask prepare-deps --platform linux",
        "cargo xtask build-streamer --gpl --release",
        "cp -r /run/build/alvr/build/alvr_streamer_linux/* /app/utils/alvr_builder"
      ],
      "modules": [ "modules/yasm/yasm.json", "modules/vulkan-headers/vulkan-headers.json", "modules/cuda/cuda.json" ],
      "sources": [ { "type": "dir", "path": "../../../" } ]
    }
  ]
}
